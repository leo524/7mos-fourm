"use strict";var templates={blocks:{},helpers:{},globals:{}};(function(){function e(e,t,n){var r=new RegExp("{"+t+"}","g");return e.replace(r,n)}function t(e){return new RegExp("<!--[\\s]*BEGIN "+e+"[\\s]*-->[\\s\\S]*<!--[\\s]*END "+e+"[\\s]*-->","g")}function n(e){return new RegExp("<!--[\\s]*IF "+e+"[\\s]*-->([\\s\\S]*?)<!--[\\s]*ENDIF "+e+"[\\s]*-->","g")}function r(e){return new RegExp("([\\s]*<!--[\\s]*IF "+e+"[\\s]*-->[\\s]*)|([\\s]*<!--[\\s]*ENDIF "+e+"[\\s]*-->[\\s]*)","gi")}function i(e,t,n){var r=e.match(t);if(r===null){return}if(n!==undefined){templates.blocks[n]=r[0]}var i=new RegExp("([\r\n]*<!-- BEGIN "+n+" -->[\r\n]*)|[\r\n]*<!-- END "+n+" -->[\r\n]*","g");return r[0].replace(i,"")}function s(e,t,n){return n.replace(e,t)}function o(e){for(var t in templates.globals){if(templates.globals.hasOwnProperty(t)){e[t]=e[t]||templates.globals[t]}}return e}function u(e,t,i){var s=n(t),o=e.match(s);if(o!==null){for(var u=0,a=o.length;u<a;u++){var f=o[u].split(/\s*<!-- ELSE -->\s*/),l=r(t);if(f[1]){if(!i){e=e.replace(o[u],f[1].replace(l,"").replace(/(^[\s]*)|([\s]*$)/gi,""))}else{e=e.replace(o[u],f[0].replace(l,"").replace(/(^[\s]*)|([\s]*$)/gi,""))}}else{if(!i){e=e.replace(o[u],"")}else{e=e.replace(o[u],o[u].replace(l,"").replace(/(^[\s]*)|([\s]*$)/gi,""))}}}}return e}function a(e,t){return e.apply(templates,[t.data,t.iterator,t.numblocks])}function f(e,t,n){var r=e.match(/{function.*?}/gi,"");for(var i in r){if(r.hasOwnProperty(i)){var s=r[i],o=r[i].split(".").pop().split("}").shift();if(templates.helpers[o]){t=t.replace(new RegExp(s,"gi"),a(templates.helpers[o],n))}}}return t}function l(e,n,r,o){e=u(e,o+"length",n[r].length);e=u(e,"!"+o+"length",!n[r].length);var a=t(r),l=i(e,a,o.substring(0,o.length-1));if(typeof l==="undefined"){return e}var c=n[r].length-1,p=0,d="";do{d+=h(l,n[r][p],o,{iterator:p,total:c})+(p<c?"\r\n":"");d=f(l,d,{data:n[r][p],iterator:p,numbloks:c})}while(p++<c);return s(a,d,e)}function c(t,n,r,i){r=typeof r==="string"?r.replace(/^\s+|\s+$/g,""):r;t=u(t,n,r);t=u(t,"!"+n,!r);if(i){t=u(t,"@first",i.iterator===0);t=u(t,"!@first",i.iterator!==0);t=u(t,"@last",i.iterator===i.total);t=u(t,"!@last",i.iterator!==i.total)}return e(t,n,r)}function h(t,n,r,i){if(!n||n.length===0){t=""}r=r||"";for(var s in n){if(n.hasOwnProperty(s)){if(typeof n[s]==="undefined"){continue}else if(n[s]===null){t=e(t,r+s,"")}else if(n[s].constructor===Array){t=l(t,n,s,r+s+".")}else if(n[s]instanceof Object){t=h(t,n[s],r+s+".")}else{t=c(t,r+s,n[s],i)}}}if(r){t=t.replace(new RegExp("{"+r+"[\\s\\S]*?}","g"),"");r=""}else{t=t.replace(/\s*<!-- ELSE -->/gi,"ENDIF -->").replace(/\s*<!-- IF([^@]*?)ENDIF([^@]*?)-->/gi,"").replace(/\s*<!-- ENDIF ([^@]*?)-->\s*/gi,"")}return t}templates.registerHelper=function(e,t){templates.helpers[e]=t};templates.parse=function(e,t){return h(t,o(e))}})()